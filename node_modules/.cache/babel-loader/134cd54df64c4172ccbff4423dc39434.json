{"ast":null,"code":"import { Map, Geolocation } from 'ol';\nimport TileLayer from 'ol/layer/Tile';\nimport VectorSource from 'ol/source/Vector';\nimport GeoJSON from 'ol/format/GeoJSON';\nimport { bbox as bboxStrategy } from 'ol/loadingstrategy';\nimport VectorLayer from 'ol/layer/Vector';\nimport Select from 'ol/interaction/Select';\nimport XYZSource from 'ol/source/XYZ';\nimport { baseLayerUrl, geoserverWfsUrl, view, locationFeature } from './MapConfig';\nimport { selectedStyle, defaultStyle } from './MapStyles';\nimport Style from 'ol/style/Style';\nimport Stroke from 'ol/style/Stroke';\nimport Circle from 'ol/style/Circle';\nimport { easeOut } from 'ol/easing';\nexport class MapUtils {\n  static createBaseLayer() {\n    const xyzURL = baseLayerUrl;\n    const baseSource = new XYZSource({\n      url: xyzURL\n    });\n    const baseLayer = new TileLayer({\n      source: baseSource\n    });\n    return baseLayer;\n  }\n\n  static createMap() {\n    const baseLayer = this.createBaseLayer();\n    const map = new Map({\n      target: 'map',\n      layers: [baseLayer],\n      view: view\n    });\n    return map;\n  } //creates a vector source based on a publised geoserver layer\n\n\n  static createSource(typename) {\n    const source = new VectorSource({\n      format: new GeoJSON(),\n      url: function (extent) {\n        return `${geoserverWfsUrl}\n                &request=GetFeature&typename=${typename}\n                &outputFormat=application/json\n                &srsname=EPSG:3857&bbox=${extent.join(',')},EPSG:3857`;\n      },\n      strategy: bboxStrategy\n    });\n    return source;\n  } //creates a vector layer based on a vector source from a published geoserver layer\n\n\n  static createVector(typename) {\n    const vectorSource = this.createSource(typename);\n    const vectorLayer = new VectorLayer({\n      source: vectorSource,\n      extent: vectorSource.getExtent(),\n      style: defaultStyle\n    });\n    vectorLayer.setMinZoom(16);\n    return vectorLayer;\n  } //creates select interaction\n\n\n  static createSelect() {\n    const select = new Select({\n      style: selectedStyle\n    });\n    return select;\n  }\n\n  static createGeolocation(map) {\n    const geolocation = new Geolocation({\n      tracking: true,\n      projection: 'EPSG:3857'\n    });\n    locationFeature.setGeometryName('geom');\n    geolocation.on('change', function () {\n      let coordinate = geolocation.getPosition();\n      let track = locationFeature.getGeometry();\n      track.setCoordinates(coordinate);\n      let center = track.getLastCoordinate();\n      view.animate({\n        zoom: 18,\n        duration: 3000,\n        center: center\n      });\n      geolocation.setTracking(false);\n    });\n    let duration = 3000;\n    var start = new Date().getTime();\n    var elapsed = start + 50 - start;\n    var elapsedRatio = elapsed / duration; //radius will be 5 at start and 30 at end.\n\n    var radius = easeOut(elapsedRatio) * 25 + 5;\n    var opacity = easeOut(1 - elapsedRatio);\n\n    const opfunc = () => {\n      for (let i = 0; i < 10; i++) {\n        return opacity = easeOut(i - elapsedRatio);\n      }\n    };\n\n    var op = setInterval(opfunc, 3000);\n    let trackLayer = new VectorLayer({\n      style: new Style({\n        image: new Circle({\n          radius: radius,\n          stroke: new Stroke({\n            color: 'rgba(255, 0, 0, ' + op + ')',\n            width: 0.25 + op\n          })\n        })\n      }),\n      source: new VectorSource({\n        features: [locationFeature]\n      })\n    });\n    map.addLayer(trackLayer);\n    alert('User successfully located. Map will zoom to current location. Your position will not be tracked.');\n    return geolocation;\n  }\n\n  static removeLastLayer(map) {\n    const layers = map.getLayers().getArray();\n    const layer = layers[layers.length - 1];\n    layer.getSource().clear();\n  }\n\n}","map":{"version":3,"sources":["C:/Users/Fabi/Desktop/Uni/Master/4. Semester/MA/WebGIS/app/src/utils/MapUtils.tsx"],"names":["Map","Geolocation","TileLayer","VectorSource","GeoJSON","bbox","bboxStrategy","VectorLayer","Select","XYZSource","baseLayerUrl","geoserverWfsUrl","view","locationFeature","selectedStyle","defaultStyle","Style","Stroke","Circle","easeOut","MapUtils","createBaseLayer","xyzURL","baseSource","url","baseLayer","source","createMap","map","target","layers","createSource","typename","format","extent","join","strategy","createVector","vectorSource","vectorLayer","getExtent","style","setMinZoom","createSelect","select","createGeolocation","geolocation","tracking","projection","setGeometryName","on","coordinate","getPosition","track","getGeometry","setCoordinates","center","getLastCoordinate","animate","zoom","duration","setTracking","start","Date","getTime","elapsed","elapsedRatio","radius","opacity","opfunc","i","op","setInterval","trackLayer","image","stroke","color","width","features","addLayer","alert","removeLastLayer","getLayers","getArray","layer","length","getSource","clear"],"mappings":"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","sourcesContent":["\r\nimport { Map, Geolocation } from 'ol';\r\nimport TileLayer from 'ol/layer/Tile';\r\nimport VectorSource from 'ol/source/Vector';\r\nimport GeoJSON from 'ol/format/GeoJSON';\r\nimport { bbox as bboxStrategy } from 'ol/loadingstrategy';\r\nimport VectorLayer from 'ol/layer/Vector';\r\nimport Select from 'ol/interaction/Select';\r\nimport XYZSource from 'ol/source/XYZ';\r\nimport { baseLayerUrl, geoserverWfsUrl, view, locationFeature } from './MapConfig';\r\nimport { selectedStyle, defaultStyle } from './MapStyles';\r\nimport Point from 'ol/geom/Point';\r\nimport Style from 'ol/style/Style';\r\nimport Stroke from 'ol/style/Stroke';\r\nimport Circle from 'ol/style/Circle';\r\nimport {easeOut} from 'ol/easing';\r\n\r\nexport class MapUtils {\r\n    static createBaseLayer() {\r\n        const xyzURL: string = baseLayerUrl;\r\n        const baseSource: XYZSource = new XYZSource({\r\n            url: xyzURL\r\n        });\r\n        const baseLayer: TileLayer = new TileLayer({\r\n            source: baseSource\r\n        });\r\n\r\n        return baseLayer;\r\n    }\r\n\r\n    static createMap() {\r\n        const baseLayer: TileLayer = this.createBaseLayer();\r\n        const map: Map = new Map({\r\n            target: 'map',\r\n            layers: [baseLayer],\r\n            view: view\r\n        });\r\n        return map;\r\n    }\r\n    //creates a vector source based on a publised geoserver layer\r\n    static createSource(typename: string) {\r\n        const source: VectorSource = new VectorSource({\r\n            format: new GeoJSON(),\r\n            url: function (extent: number[]) {\r\n                return `${geoserverWfsUrl}\r\n                &request=GetFeature&typename=${typename}\r\n                &outputFormat=application/json\r\n                &srsname=EPSG:3857&bbox=${extent.join(',')},EPSG:3857`;\r\n            },\r\n            strategy: bboxStrategy,\r\n        });\r\n        return source;\r\n    }\r\n    //creates a vector layer based on a vector source from a published geoserver layer\r\n    static createVector(typename: string) {\r\n        const vectorSource: VectorSource = this.createSource(typename);\r\n        const vectorLayer: VectorLayer = new VectorLayer({\r\n            source: vectorSource,\r\n            extent: vectorSource.getExtent(),\r\n            style: defaultStyle,\r\n        });\r\n        vectorLayer.setMinZoom(16)\r\n        return vectorLayer;\r\n    }\r\n    //creates select interaction\r\n    static createSelect(): Select {\r\n        const select: Select = new Select({\r\n            style: selectedStyle\r\n        });\r\n        return select;\r\n    }\r\n\r\n    static createGeolocation(map: Map | null): Geolocation {\r\n        const geolocation = new Geolocation({\r\n            tracking: true,\r\n            projection: 'EPSG:3857',\r\n        });\r\n        locationFeature.setGeometryName('geom');\r\n        geolocation.on('change', function () {\r\n            let coordinate: number[] = geolocation.getPosition();\r\n            let track: Point = locationFeature.getGeometry() as Point;\r\n            track.setCoordinates(coordinate);\r\n            let center = track.getLastCoordinate();\r\n            view.animate({\r\n                zoom: 18,\r\n                duration: 3000,\r\n                center: center,\r\n            })\r\n            geolocation.setTracking(false)\r\n        });\r\n        let duration = 3000\r\n        var start = new Date().getTime();\r\n       var elapsed = start+50 - start;\r\n        var elapsedRatio = elapsed / duration;\r\n        //radius will be 5 at start and 30 at end.\r\n        var radius = easeOut(elapsedRatio) * 25 + 5;\r\n        var opacity = easeOut(1 - elapsedRatio);\r\n        const opfunc = () => {\r\n            for (let i = 0; i<10; i++) {\r\n                return opacity = easeOut(i - elapsedRatio);\r\n            }\r\n        }\r\n        var op = setInterval(opfunc, 3000)\r\n        let trackLayer = new VectorLayer({\r\n            style: new Style({\r\n                image: new Circle({\r\n                    radius: radius,\r\n                    stroke: new Stroke({\r\n                        color: 'rgba(255, 0, 0, ' + op + ')',\r\n                        width: 0.25 + op\r\n                    })\r\n                })\r\n            }),\r\n            source: new VectorSource({\r\n                features: [locationFeature],\r\n            }),\r\n        });\r\n        map!.addLayer(trackLayer);\r\n        alert('User successfully located. Map will zoom to current location. Your position will not be tracked.')\r\n        return geolocation;\r\n    }\r\n\r\n    static removeLastLayer(map: Map | null) {\r\n        const layers = map!.getLayers().getArray();\r\n        const layer = layers[layers.length - 1] as VectorLayer;\r\n        layer.getSource().clear();\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}