{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Fabi\\\\Desktop\\\\Uni\\\\Master\\\\4_Semester\\\\MA\\\\WebGIS\\\\app\\\\src\\\\components\\\\MapSidebar.tsx\";\nimport React, { useState, useEffect } from 'react';\nimport 'ol/ol.css';\nimport Sidebar from './Sidebar';\nimport Tab from './Tab';\nimport ToggleButton from './ToogleButton';\nimport TabContent from './TabContent';\nimport { Feature } from 'ol';\nimport { activeToggleColor } from '../utils/MapStyles';\nimport Button from './Button';\nimport { wfsTransaction, usedIcons, updateParameters, geoserverFetchUrl } from '../utils/MapConfig';\nimport { MapUtils } from '../utils/MapUtils';\nimport Legend from './Legend';\nimport Instructions from './Instructions';\nimport Home from './Home';\nimport Image from './Image';\nimport logo from '../img/rub_logo.png';\nimport Loading from './Loading';\nconst mapListeners = [];\n\nconst MapSidebar = props => {\n  const {\n    map\n  } = props;\n  const [collapsed, setCollapsed] = useState(false);\n  const [selected, setSelected] = useState('home');\n  const [toggleValue, setToggleValue] = useState(false);\n  const [selectedFeature, setSelectedFeature] = useState(new Feature());\n  const [transactionResponse, setTransactionResponse] = useState('');\n  const [token, setToken] = useState(localStorage.getItem('VgiUserToken'));\n\n  function hashUser() {\n    fetch('http://192.168.2.185:8000/hash').then(response => response.json()).then(value => localStorage.setItem('VgiUserToken', value));\n  }\n\n  useEffect(() => {\n    if (localStorage.getItem('VgiUserToken') === null) {\n      hashUser();\n    } else {\n      return;\n    }\n  }, []);\n\n  function onClose() {\n    setCollapsed(true); //@ts-ignore\n\n    setSelected(undefined);\n  }\n\n  function onOpen(id) {\n    setCollapsed(false); //@ts-ignore\n\n    setSelected(id);\n  }\n\n  ;\n\n  function onToggleChange() {\n    setToggleValue(!toggleValue);\n    selectedFeature.set('visited', !toggleValue);\n  }\n\n  const saveData = () => {\n    if (selectedFeature) {\n      setTransactionResponse('Updating');\n\n      if (selectedFeature.getId()) {\n        selectedFeature.unset('selected');\n        selectedFeature.getId();\n        selectedFeature.setGeometryName('geom');\n        selectedFeature.set('visited', toggleValue);\n        selectedFeature.set('edited_by', token);\n        let xmlString = new XMLSerializer().serializeToString(wfsTransaction.writeTransaction([], [selectedFeature], [], updateParameters));\n        let body = {\n          xml: xmlString\n        };\n        fetch(geoserverFetchUrl, {\n          method: 'POST',\n          body: JSON.stringify(body)\n        }).then(() => setTransactionResponse(`Gebäude mit id ${selectedFeature.getId()} wurde erfasst. Danke für deinen Beitrag.`)).then(() => setTimeout(() => setTransactionResponse(''), 3000)).then(() => {\n          //@ts-ignore\n          const layer = map.getLayers().getArray()[1];\n          layer.getSource().clear();\n          layer.getSource().refresh();\n        }).catch(error => console.log('Die Änderungen konnten nicht gespeichert werden.'));\n      } else {\n        setTransactionResponse('Kein Gebäude selektiert.');\n        setTimeout(() => setTransactionResponse(''), 3000);\n        return;\n      }\n    } else {\n      setTransactionResponse('Die Änderungen konnten nicht gespeichert werden, probiere es bitte erneut.');\n      setTimeout(() => setTransactionResponse(''), 3000);\n      return;\n    }\n  };\n\n  let prevSelected = [];\n\n  if (map) {\n    if (mapListeners.length === 0) {\n      const mapListener = map.on('click', function (e) {\n        map.forEachFeatureAtPixel(e.pixel, feature => {\n          let castedFeature = feature;\n          prevSelected.unshift(castedFeature);\n          setSelectedFeature(prevSelected[0]);\n          prevSelected[0].set('selected', true);\n\n          if (prevSelected.length > 1) {\n            prevSelected[1].set('selected', false);\n          }\n\n          prevSelected.splice(1);\n        });\n      });\n      mapListeners.push(mapListener);\n    }\n  }\n\n  return React.createElement(React.Fragment, null, React.createElement(Sidebar, {\n    id: \"sidebar\",\n    collapsed: collapsed,\n    selected: selected,\n    onClose: onClose //@ts-ignore\n    ,\n    doOpen: onOpen,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128\n    },\n    __self: this\n  }, React.createElement(Tab, {\n    id: \"home\",\n    header: \"Beschreibung\",\n    faIcon: usedIcons[0],\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136\n    },\n    __self: this\n  }, React.createElement(TabContent, {\n    content: React.createElement(React.Fragment, null, React.createElement(Home, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143\n      },\n      __self: this\n    }), React.createElement(Button, {\n      buttonText: `Informationen `,\n      faIcon: usedIcons[1],\n      clickButton: () => setSelected('instructions'),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144\n      },\n      __self: this\n    }), React.createElement(Image, {\n      altText: \"RUB-Logo\",\n      img: logo,\n      link: \"https://www.geographie.ruhr-uni-bochum.de/forschung/geomatik/home-news/\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149\n      },\n      __self: this\n    })),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141\n    },\n    __self: this\n  })), React.createElement(Tab, {\n    id: \"locations\",\n    header: \"Besuchte Geb\\xE4ude\",\n    faIcon: usedIcons[2],\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158\n    },\n    __self: this\n  }, React.createElement(TabContent, {\n    content: React.createElement(React.Fragment, null, React.createElement(Legend, {\n      title: \"Legende\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165\n      },\n      __self: this\n    }), React.createElement(ToggleButton, {\n      id: \"toggleVisited\",\n      isOn: selectedFeature.get('visited'),\n      isOnColor: activeToggleColor,\n      handleToggle: onToggleChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168\n      },\n      __self: this\n    }), JSON.stringify(selectedFeature.get('visited')), transactionResponse !== 'Updating' ? React.createElement(Button, {\n      buttonText: \"Update\",\n      response: transactionResponse,\n      clickButton: saveData,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179\n      },\n      __self: this\n    }) : React.createElement(Loading, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185\n      },\n      __self: this\n    })),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163\n    },\n    __self: this\n  })), React.createElement(Tab, {\n    id: \"instructions\",\n    header: \"Informationen\",\n    faIcon: usedIcons[1],\n    anchor: \"bottom\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190\n    },\n    __self: this\n  }, React.createElement(TabContent, {\n    content: React.createElement(React.Fragment, null, React.createElement(Instructions, {\n      token: token,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198\n      },\n      __self: this\n    })),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196\n    },\n    __self: this\n  })), React.createElement(Tab, {\n    id: \"tracking\",\n    header: \"Standort lokalisieren\",\n    faIcon: usedIcons[3],\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206\n    },\n    __self: this\n  }, React.createElement(TabContent, {\n    content: React.createElement(React.Fragment, null, React.createElement(Button, {\n      buttonText: \"Standort lokalisieren\",\n      clickButton: () => MapUtils.createGeolocation(map),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213\n      },\n      __self: this\n    })),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211\n    },\n    __self: this\n  }))));\n};\n\nexport default MapSidebar;","map":{"version":3,"sources":["C:/Users/Fabi/Desktop/Uni/Master/4_Semester/MA/WebGIS/app/src/components/MapSidebar.tsx"],"names":["React","useState","useEffect","Sidebar","Tab","ToggleButton","TabContent","Feature","activeToggleColor","Button","wfsTransaction","usedIcons","updateParameters","geoserverFetchUrl","MapUtils","Legend","Instructions","Home","Image","logo","Loading","mapListeners","MapSidebar","props","map","collapsed","setCollapsed","selected","setSelected","toggleValue","setToggleValue","selectedFeature","setSelectedFeature","transactionResponse","setTransactionResponse","token","setToken","localStorage","getItem","hashUser","fetch","then","response","json","value","setItem","onClose","undefined","onOpen","id","onToggleChange","set","saveData","getId","unset","setGeometryName","xmlString","XMLSerializer","serializeToString","writeTransaction","body","xml","method","JSON","stringify","setTimeout","layer","getLayers","getArray","getSource","clear","refresh","catch","error","console","log","prevSelected","length","mapListener","on","e","forEachFeatureAtPixel","pixel","feature","castedFeature","unshift","splice","push","get","createGeolocation"],"mappings":"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","sourcesContent":["\r\nimport React, { useState, useEffect } from 'react';\r\nimport 'ol/ol.css';\r\nimport { IMapSidebarProps, TSelectableTabs } from '../types/types';\r\nimport Sidebar from './Sidebar';\r\nimport Tab from './Tab';\r\nimport ToggleButton from './ToogleButton';\r\nimport TabContent from './TabContent';\r\nimport { Feature, MapBrowserEvent } from 'ol';\r\nimport { FeatureLike } from 'ol/Feature';\r\nimport { activeToggleColor } from '../utils/MapStyles';\r\nimport Button from './Button';\r\nimport { wfsTransaction, usedIcons, updateParameters, geoserverFetchUrl } from '../utils/MapConfig';\r\nimport VectorLayer from 'ol/layer/Vector';\r\nimport { MapUtils } from '../utils/MapUtils';\r\nimport Legend from './Legend';\r\nimport Instructions from './Instructions';\r\nimport Home from './Home';\r\nimport Image from './Image';\r\nimport logo from '../img/rub_logo.png';\r\nimport Loading from './Loading';\r\n\r\nconst mapListeners = [];\r\n\r\nconst MapSidebar = (props: IMapSidebarProps): JSX.Element => {\r\n\r\n    const { map } = props;\r\n\r\n    const [collapsed, setCollapsed] = useState(false);\r\n    const [selected, setSelected] = useState<TSelectableTabs>('home');\r\n    const [toggleValue, setToggleValue] = useState(false);\r\n    const [selectedFeature, setSelectedFeature] = useState(new Feature());\r\n    const [transactionResponse, setTransactionResponse] = useState('');\r\n    const [token, setToken] = useState(localStorage.getItem('VgiUserToken'));\r\n\r\n    function hashUser() {\r\n        fetch('http://192.168.2.185:8000/hash')\r\n            .then(response => response.json())\r\n            .then(value => localStorage.setItem('VgiUserToken', value))\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (localStorage.getItem('VgiUserToken') === null) {\r\n            hashUser()\r\n        }\r\n        else { return }\r\n    }, [])\r\n\r\n    function onClose() {\r\n        setCollapsed(true);\r\n        //@ts-ignore\r\n        setSelected(undefined);\r\n    }\r\n    function onOpen(id: string) {\r\n        setCollapsed(false)\r\n        //@ts-ignore\r\n        setSelected(id)\r\n    };\r\n\r\n    function onToggleChange() {\r\n        setToggleValue(!toggleValue)\r\n        selectedFeature.set('visited', !toggleValue)\r\n    }\r\n\r\n    const saveData = () => {\r\n        if (selectedFeature) {\r\n            setTransactionResponse('Updating')\r\n            if (selectedFeature.getId()) {\r\n                selectedFeature.unset('selected')\r\n                selectedFeature.getId();\r\n                selectedFeature.setGeometryName('geom');\r\n                selectedFeature.set('visited', toggleValue);\r\n                selectedFeature.set('edited_by', token);\r\n                let xmlString = new XMLSerializer().serializeToString(\r\n                    wfsTransaction.writeTransaction([], [selectedFeature], [], updateParameters)\r\n                )\r\n                let body = {\r\n                    xml: xmlString,\r\n                }\r\n                fetch(geoserverFetchUrl, {\r\n                    method: 'POST',\r\n                    body: JSON.stringify(body)\r\n                })\r\n                    .then(() => setTransactionResponse(`Gebäude mit id ${selectedFeature.getId()} wurde erfasst. Danke für deinen Beitrag.`))\r\n                    .then(() => setTimeout(() => setTransactionResponse(''), 3000))\r\n                    .then(() => {\r\n                        //@ts-ignore\r\n                        const layer: VectorLayer = map!.getLayers().getArray()[1];\r\n                        layer.getSource().clear();\r\n                        layer.getSource().refresh();\r\n                    })\r\n                    .catch(error => console.log('Die Änderungen konnten nicht gespeichert werden.'));\r\n            }\r\n            else {\r\n                setTransactionResponse('Kein Gebäude selektiert.')\r\n                setTimeout(() => setTransactionResponse(''), 3000);\r\n                return;\r\n            }\r\n        }\r\n        else {\r\n            setTransactionResponse('Die Änderungen konnten nicht gespeichert werden, probiere es bitte erneut.')\r\n            setTimeout(() => setTransactionResponse(''), 3000);\r\n            return;\r\n        }\r\n    }\r\n\r\n    let prevSelected: Feature[] = []\r\n    if (map) {\r\n        if (mapListeners.length === 0) {\r\n            const mapListener = map.on('click', function (e: MapBrowserEvent): void {\r\n                map!.forEachFeatureAtPixel(e.pixel, (feature: Feature | FeatureLike): void => {\r\n                    let castedFeature: Feature = feature as Feature;\r\n                    prevSelected.unshift(castedFeature)\r\n                    setSelectedFeature(prevSelected[0]);\r\n                    prevSelected[0].set('selected', true);\r\n                    if (prevSelected.length > 1) {\r\n                        prevSelected[1].set('selected', false);\r\n                    }\r\n                    prevSelected.splice(1)\r\n                });\r\n            });\r\n            mapListeners.push(mapListener);\r\n        }\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <Sidebar\r\n                id='sidebar'\r\n                collapsed={collapsed}\r\n                selected={selected}\r\n                onClose={onClose}\r\n                //@ts-ignore\r\n                doOpen={onOpen}\r\n            >\r\n                <Tab\r\n                    id='home'\r\n                    header='Beschreibung'\r\n                    faIcon={usedIcons[0]}\r\n                >\r\n                    <TabContent content={\r\n                        <>\r\n                            <Home />\r\n                            <Button\r\n                                buttonText={`Informationen `}\r\n                                faIcon={usedIcons[1]}\r\n                                clickButton={() => setSelected('instructions')}\r\n                            />\r\n                            <Image\r\n                                altText='RUB-Logo'\r\n                                img={logo}\r\n                                link='https://www.geographie.ruhr-uni-bochum.de/forschung/geomatik/home-news/'\r\n                            />\r\n                        </>\r\n                    }\r\n                    />\r\n                </Tab>\r\n                <Tab\r\n                    id='locations'\r\n                    header='Besuchte Gebäude'\r\n                    faIcon={usedIcons[2]}\r\n                >\r\n                    <TabContent content={\r\n                        <>\r\n                            <Legend\r\n                                title='Legende'\r\n                            />\r\n                            <ToggleButton\r\n                                id='toggleVisited'\r\n                                isOn={selectedFeature.get('visited')}\r\n                                isOnColor={activeToggleColor}\r\n                                handleToggle={onToggleChange}\r\n                            />\r\n                            {\r\n                                JSON.stringify(selectedFeature.get('visited'))\r\n                            }\r\n                            {\r\n                                transactionResponse !== 'Updating' ?\r\n                                    <Button\r\n                                        buttonText='Update'\r\n                                        response={transactionResponse}\r\n                                        clickButton={saveData}\r\n                                    />\r\n                                    :\r\n                                    <Loading />\r\n                            }\r\n                        </>\r\n                    } />\r\n                </Tab>\r\n                <Tab\r\n                    id='instructions'\r\n                    header='Informationen'\r\n                    faIcon={usedIcons[1]}\r\n                    anchor='bottom'\r\n                >\r\n                    <TabContent content={\r\n                        <>\r\n                            <Instructions \r\n                                token={token}\r\n                               \r\n                            />\r\n                        </>\r\n                    }\r\n                    />\r\n                </Tab>\r\n                <Tab\r\n                    id='tracking'\r\n                    header='Standort lokalisieren'\r\n                    faIcon={usedIcons[3]}\r\n                >\r\n                    <TabContent content={\r\n                        <>\r\n                            <Button\r\n                                buttonText='Standort lokalisieren'\r\n                                clickButton={() => MapUtils.createGeolocation(map)}\r\n                            />                            \r\n                        </>\r\n                    } />\r\n                </Tab>\r\n            </Sidebar>\r\n        </>\r\n    )\r\n}\r\n\r\nexport default MapSidebar;"]},"metadata":{},"sourceType":"module"}